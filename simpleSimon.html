<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Simon</title>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
</head>
<body>
<div class="wrapper">
    <div class="back">
        <div class="pad shape1" data-pad="1">
        </div>
        <div class="pad shape2" data-pad="2">
        </div>
        <div class="pad shape3" data-pad="3">
        </div>
        <div class="pad shape4" data-pad="4">
        </div>
        <div class="circle"></div>
    </div>

    <div class="level">
        <h2>Level: 1</h2>
    </div>
    <div class="score">
        <h2>Score: 0</h2>
    </div>
    <ul class="mode">
        <li>
            <input type="radio" class="modeOpt" name="mode" value="1" checked>Classic
        </li>
        <li>
            <input type="radio" class="modeOpt" name="mode" value="0">Non Classic
        </li>
    </ul>

    <ul class="difficulty">

        <li>
            <input type="radio" class="difOpt" name="difficulty" value="2">Easy
        </li>
        <li>
            <input type="radio" class="difOpt" name="difficulty" value="1" checked>Normal
        </li>
    </ul>
    <div class="sButton">
        <button class="start">start</button>
    </div>
</div>
<script>
    var game={
        level: 1,
        turn: 0,
        difficulty: 1,
        classic: 1,
        score: 0,
        active: false,
        handler: false,
        shape: ".shape",
        genSequence: [],
        plaSequence: [],

        init: function(){
            if(this.handler === false){
                this.initPadHandler();
            }
            this.newGame();

        },

        initPadHandler: function(){

            that=this;

            $(".pad").on('click',function(){

                if(that.active===true){

                    var pad=parseInt($(this).data('pad'),10);

                    that.flash($(this),1,300, pad);

                    that.logPlayerSequence(pad);
                    console.log();

                }
            });

            this.handler=true;

        },

        newGame: function(){

            this.level=1;
            this.score=0;
            this.newLevel();
            this.displayLevel();
            this.displayScore();

        },

        newLevel: function(){

            this.plaSequence.length=0;
            this.pos=0;
            this.turn=0;
            this.active=true;

            if(this.classic !== 1){

                this.genSequence.length=0;
                this.randomizePad(this.level);

            }else if(this.classic ===1 && this.level ===1){

                this.genSequence.length=0;
                this.randomizePad(50);
            }

            if(this.classic ===1 && this.level > 50){
                this.level = 50;
            }

            this.displaySequence();

        },

        flash: function(element, times, speed, pad){

            if(times > 0){
                element.stop().animate({opacity: '1'}, {
                    duration: 50,
                    complete: function(){
                        element.stop().animate({opacity: '0.6'}, 200);
                    }
                });

            }

            if (times > 0) {
                setTimeout(function () {
                    that.flash(element, times, speed, pad);
                }, speed);
                times -= 1;
            }
        },

        randomizePad: function(passes){

            for(i = 0;i<passes;i++){

                this.genSequence.push(Math.floor(Math.random() * 4) + 1);
            }
        },

        logPlayerSequence: function(pad){

            this.plaSequence.push(pad);
            this.checkSequence();


        },

        checkSequence: function(pad){

            if(this.plaSequence[this.turn] !== this.genSequence[this.turn]){

                this.incorrectSequence(pad);

            }else{
                this.keepScore();
                this.turn++;

            }

            if(this.turn === this.level){

                this.level++;
                this.displayLevel();
                this.active=false;
                setTimeout(function(){
                    that.newLevel();
                },1000);
            }
        },

        displaySequence: function(){

            $.each(this.genSequence, function(index, val) {

                setTimeout(function(){

                    that.flash($(that.shape+val),1,300,val);

                },500*index*that.difficulty);

                if(index === that.level-1){
                    return false;
                }
            });
        },

        displayLevel: function(){

            $('.level h2').text("Level: "+this.level);

        },

        displayScore: function(){
            $('.score h2').text("Score: "+this.score);
        },

        keepScore: function(){

            var multiplier=0;

            switch(this.difficulty)
            {
                case '2':
                    multiplier=1;
                    break;

                case '1':
                    multiplier=2;
                    break;

                case '0.5':
                    multiplier = 3;
                    break;

                case '0.25':
                    multiplier = 4;
                    break;
            }

            this.score += (1 * multiplier);

            this.displayScore();
        },

        incorrectSequence: function(){

            var corPad = this.genSequence[this.turn],

                    that = this;
            this.active=false;
            this.displayLevel();
            this.displayScore();

            setTimeout(function(){
                that.flash($(that.shape+corPad),4,300,corPad);
            },500);

            $(".start").show();
            $(".difficulty").show();
            $(".mode").show();

        }

    };
    $(document).ready(function(){

        $(".start").on("mouseup", function(){
            $(this).hide();
            game.difficulty = $('input[name=difficulty]:checked').val();
            $(".difficulty").hide();
            game.classic = parseInt($('input[name=mode]:checked').val(),10);
            $(".mode").hide();
            game.init();
        });
    });
</script>
<script src="simpleSimon.css"></script>
</body>
</html>